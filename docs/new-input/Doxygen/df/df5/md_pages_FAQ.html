<!-- HTML header for doxygen 1.8.19-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.19"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Control Surface: Frequently Asked Questions</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/SVG"],
});
</script>
<script type="text/javascript" async="async" src="/MathJax/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&family=Roboto:wght@400&family=Roboto:wght@500&display=swap" rel="stylesheet">
<link href="../../custom_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Control Surface
   &#160;<span id="projectnumber"><code>new-input</code></span>
   </div>
   <div id="projectbrief">MIDI Control Surface library for Arduino</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.19 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Frequently Asked Questions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#faq-terminology">Terminology</a></li>
<li class="level1"><a href="#faq-mux-encoder">Can I use multiplexers for reading rotary encoders?</a></li>
<li class="level1"><a href="#faq-change-address-runtime">Can I change the address, controller number, MIDI channel, etc. at runtime?</a></li>
<li class="level1"><a href="#faq-banks">How do banks work?</a><ul><li class="level2"><a href="#autotoc_md293">Normal banks</a></li>
<li class="level2"><a href="#autotoc_md294">Many addresses</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="faq-terminology"></a>
Terminology</h1>
<ul>
<li><b>MIDI Output Element</b>: Any component of a MIDI controller that sends out MIDI messages (e.g. a push button or a potentiometer).</li>
<li><b>MIDI Input Element</b>: Any component of a MIDI controller that listens for incoming MIDI messages (e.g. an LED that indicates the “mute” or “solo” status of a track, or a display with a level meter that shows the level of the audio playing in the DAW).</li>
<li><b>MIDI Element</b>: Broad term for both MIDI Output Elements and MIDI Input Elements. It usually refers to both the actual hardware (e.g. a push button) and the software object that reads the hardware and sends or receives the MIDI messages (e.g. a <code><a class="el" href="../../d1/d9f/classNoteButton.html" title="A class of MIDIOutputElements that read the input of a momentary push button or switch,...">NoteButton</a></code> object or variable in the Arduino code).</li>
</ul>
<h1><a class="anchor" id="faq-mux-encoder"></a>
Can I use multiplexers for reading rotary encoders?</h1>
<p>No, rotary encoders either need interrupts or have to be polled at a sufficiently high rate to work correctly, otherwise, you'll miss pulses when turning the encoder too quickly. Multiplexers generally do not generate interrupts when the inputs change, and polling them is often too slow. If your code contains other slow operations, such as updating a display or reading many analog inputs, polling is no longer an option.</p>
<p>If you can, try to connect rotary encoders to the Arduino directly, with at least one interrupt pin per encoder, preferably two.</p>
<p>If that's not an option because you're running out of pins, you can use a port expander, such as the MCP23017. These chips can be configured to generate an interrupt whenever one of the inputs changes, and also have built-in pull-up resistors, which is handy. <br  />
 To read encoders with the MCP23017 in an interrupt-driven way, the microcontroller should support I²C inside of an ISR (Interrupt Service Routine), in order to communicate with the port expander to check which pin changed. Not all microcontrollers support this, but the ARM processors of the Teensy 3.x and 4.x lines do. <br  />
 If I²C communication is not possible inside of an ISR (AVR Arduino boards, ESP32, etc.), you can still use polling, on the condition that the rest of your code doesn't take too long.</p>
<p>There are two examples for using rotary encoders with a MCP23017:</p><ul>
<li><a class="el" href="../../dd/d56/MCP23017-RotaryEncoder-Interrupts_8ino-example.html">MCP23017-RotaryEncoder-Interrupts.ino</a> (Teensy)</li>
<li><a class="el" href="../../d7/dac/MCP23017-RotaryEncoder-No-Interrupts_8ino-example.html">MCP23017-RotaryEncoder-No-Interrupts.ino</a> (Other boards)</li>
</ul>
<h1><a class="anchor" id="faq-change-address-runtime"></a>
Can I change the address, controller number, MIDI channel, etc. at runtime?</h1>
<p>Yes, this is done through banks. See the <a class="el" href="../../d0/d74/Bank_8ino-example.html">Bank.ino</a> example. <br  />
 The standard <a class="el" href="../../d2/d00/group__BankableMIDIOutputElements.html">Bankable MIDI Output Elements</a> have fixed offsets between the different addresses (e.g. address bank 1 = controller #8, bank 2 = controller #16, bank 3 = controller #24 and bank 4 = controller #32), while the <a class="el" href="../../d3/dc0/group__ManyAddressesMIDIOutputElements.html">Many Addresses MIDI Output Elements</a> allow you to specify arbitrary addresses, they don't need to have a fixed offset between them.</p>
<h1><a class="anchor" id="faq-banks"></a>
How do banks work?</h1>
<p>There are two kinds of “Bankable” MIDI Elements: the standard <code><a class="el" href="../../d1/dd0/namespaceBankable.html" title="A namespace for MIDI elements that can be added to a Bank, to change their address or channel.">Bankable</a></code> elements and the <code><a class="el" href="../../db/d14/namespaceBankable_1_1ManyAddresses.html">Bankable::ManyAddresses</a></code> elements.</p>
<h2><a class="anchor" id="autotoc_md293"></a>
Normal banks</h2>
<p>Normal <code><a class="el" href="../../d1/dd0/namespaceBankable.html" title="A namespace for MIDI elements that can be added to a Bank, to change their address or channel.">Bankable</a></code> elements allow you to change the address of the element by multiples of a fixed offset. You can change the MIDI address (such as controller number or note number), the MIDI channel or the MIDI USB virtual cable number of the <code><a class="el" href="../../d1/dd0/namespaceBankable.html" title="A namespace for MIDI elements that can be added to a Bank, to change their address or channel.">Bankable</a></code> element. <br  />
 The formula for the address is a linear function of the active bank: </p><p class="formulaDsp">
\[ y = ax + b, \]
</p>
<p> where \( y \) is the effective address, \( a \) is the fixed offset between banks, \( x \) is the currently selected bank ( \( x=0 \) is the first bank), and \( b \) is the base address, which is the address when the first bank is selected. The offset \( a \) is a property of the <a class="el" href="../../db/dbd/classBank.html" title="A class that groups Bankable BankableMIDIOutputs and BankableMIDIInputs, and allows the user to chang...">Bank</a>, and the base address \( b \) is a property of the <code><a class="el" href="../../d1/dd0/namespaceBankable.html" title="A namespace for MIDI elements that can be added to a Bank, to change their address or channel.">Bankable</a></code> MIDI element.</p>
<p>This formula is rather abstract, and it might not immediately be clear why this is useful, so I'd recommend playing around some with the <a class="el" href="../../d0/d74/Bank_8ino-example.html">Bank.ino</a> example.</p>
<p>Another example is the following: imagine that you want to mute or un-mute any of the 12 audio tracks in your DAW using only 4 physical buttons. In that case, you could use 3 banks to change the addresses of the buttons. When the first bank is selected, the first button mutes track 1, the second button mutes track 2, etc. When the second bank is selected, the first button mutes track 5, the second button mutes track 6, and so on. <br  />
 In this example, the offset \( a \) is 4, the number of buttons, or the number of tracks you can control per bank. The base address \( b \) of the first button is 1, for the second button, it's 2, for the third button, it's 3, and so on.</p>
<p>Click the buttons in the animation below to get a feel for how it works:</p>
<p> 
<object type="image/svg+xml" data="../../bank-bankable.svg" style="margin: 0 auto; display: block"></object>
</p>
<div class="fragment"><div class="line"><a class="code" href="../../db/dbd/classBank.html">Bank&lt;3&gt;</a> bank(4); <span class="comment">// 3 banks with an offset of 4 tracks per bank (a = 4)</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="../../de/d36/classBankable_1_1NoteButton.html">Bankable::NoteButton</a> muteButtons[] {</div>
<div class="line">    {bank, pin1, 1}, <span class="comment">// base address 1 (b = 1)</span></div>
<div class="line">    {bank, pin2, 2}, <span class="comment">// base address 2 (b = 2)</span></div>
<div class="line">    {bank, pin3, 3}, <span class="comment">// base address 3 (b = 3)</span></div>
<div class="line">    {bank, pin4, 4}, <span class="comment">// base address 4 (b = 4)</span></div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md294"></a>
Many addresses</h2>
<p>In most cases, the standard <code><a class="el" href="../../d1/dd0/namespaceBankable.html" title="A namespace for MIDI elements that can be added to a Bank, to change their address or channel.">Bankable</a></code> elements are sufficient, but sometimes, you might need a more flexible solution. The <code><a class="el" href="../../db/d14/namespaceBankable_1_1ManyAddresses.html">Bankable::ManyAddresses</a></code> elements allow you to specify an arbitrary list of alternative addresses. The formula for the address is simply a table lookup in that list of addresses, based on the active bank: </p><p class="formulaDsp">
\[ y = \text{list of addresses}[x] \]
</p>
<p>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="aclassBankable_1_1NoteButton_html"><div class="ttname"><a href="../../de/d36/classBankable_1_1NoteButton.html">Bankable::NoteButton</a></div><div class="ttdoc">A class of MIDIOutputElements that read the input of a momentary push button or switch,...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d8e/Bankable_2NoteButton_8hpp_source.html#l00022">Bankable/NoteButton.hpp:22</a></div></div>
<div class="ttc" id="aclassBank_html"><div class="ttname"><a href="../../db/dbd/classBank.html">Bank</a></div><div class="ttdoc">A class that groups Bankable BankableMIDIOutputs and BankableMIDIInputs, and allows the user to chang...</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d57/Bank_8hpp_source.html#l00096">Bank.hpp:96</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.19
</small></address>
</body>
</html>
